See the PDF file and the comments in the code.
